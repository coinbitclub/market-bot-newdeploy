<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste APIs - DADOS REAIS APENAS</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; }
        .api-test { border: 2px solid #333; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .api-test h3 { color: #4CAF50; margin: 0 0 10px 0; }
        .api-test button { 
            background: #2196F3; color: white; border: none; padding: 8px 16px; 
            border-radius: 4px; cursor: pointer; margin: 5px 5px 10px 0; 
        }
        .api-test button:hover { background: #1976D2; }
        .response { 
            background: #2a2a2a; padding: 15px; border-radius: 4px; 
            border-left: 4px solid #4CAF50; white-space: pre-wrap; 
            font-family: 'Courier New', monospace; font-size: 12px;
            max-height: 400px; overflow-y: auto;
        }
        .header { text-align: center; padding: 20px 0; border-bottom: 2px solid #4CAF50; margin-bottom: 20px; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .status.success { background: rgba(76, 175, 80, 0.2); border-left: 4px solid #4CAF50; }
        .status.error { background: rgba(244, 67, 54, 0.2); border-left: 4px solid #f44336; }
        .warning { background: rgba(255, 152, 0, 0.2); border-left: 4px solid #ff9800; padding: 10px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ PAINEL TRADING REAL - TESTE DE APIs</h1>
            <p>Sistema com ZERO dados mock/est√°ticos - APENAS DADOS REAIS do PostgreSQL</p>
            <div id="connection-status" class="status">Verificando conex√£o...</div>
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è ATEN√á√ÉO:</strong> Este sistema utiliza EXCLUSIVAMENTE dados reais do banco PostgreSQL. 
            Todas as m√©tricas s√£o baseadas em dados verdadeiros - sem simula√ß√µes ou dados est√°ticos.
        </div>

        <div class="api-test">
            <h3>üîç Health Check & Status</h3>
            <button onclick="testAPI('/health', 'health-response')">Testar Health</button>
            <div id="health-response" class="response">Clique no bot√£o para testar...</div>
        </div>

        <div class="api-test">
            <h3>üìä Dados Principais do Painel</h3>
            <button onclick="testAPI('/api/painel/dados', 'dados-response')">Testar Dados Principais</button>
            <div id="dados-response" class="response">Clique no bot√£o para testar...</div>
        </div>

        <div class="api-test">
            <h3>üíº Dashboard Executivo</h3>
            <button onclick="testAPI('/api/painel/executivo', 'executivo-response')">Testar Dashboard Executivo</button>
            <div id="executivo-response" class="response">Clique no bot√£o para testar...</div>
        </div>

        <div class="api-test">
            <h3>üîÑ Fluxo Operacional</h3>
            <button onclick="testAPI('/api/painel/fluxo', 'fluxo-response')">Testar Fluxo Operacional</button>
            <div id="fluxo-response" class="response">Clique no bot√£o para testar...</div>
        </div>

        <div class="api-test">
            <h3>üë• Monitoramento de Usu√°rios</h3>
            <button onclick="testAPI('/api/painel/usuarios', 'usuarios-response')">Testar Usu√°rios</button>
            <div id="usuarios-response" class="response">Clique no bot√£o para testar...</div>
        </div>

        <div class="api-test">
            <h3>üö® Sistema de Alertas</h3>
            <button onclick="testAPI('/api/painel/alertas', 'alertas-response')">Testar Alertas</button>
            <div id="alertas-response" class="response">Clique no bot√£o para testar...</div>
        </div>

        <div class="api-test">
            <h3>üîÑ Teste Completo</h3>
            <button onclick="testAllAPIs()">Testar Todas as APIs</button>
            <div id="complete-response" class="response">Clique no bot√£o para testar todas as APIs...</div>
        </div>
    </div>

    <script>
        const baseURL = 'http://localhost:3000';
        
        // Fun√ß√£o para testar uma API espec√≠fica
        async function testAPI(endpoint, responseElementId) {
            const responseElement = document.getElementById(responseElementId);
            responseElement.textContent = '‚è≥ Testando...';
            
            try {
                const response = await fetch(baseURL + endpoint);
                const data = await response.json();
                
                const formattedResponse = `
STATUS: ${response.status} ${response.statusText}
TIMESTAMP: ${new Date().toLocaleString('pt-BR')}
ENDPOINT: ${endpoint}

RESPONSE:
${JSON.stringify(data, null, 2)}`;
                
                responseElement.textContent = formattedResponse;
                
                // Atualizar status da conex√£o
                if (response.ok) {
                    updateConnectionStatus('success', 'Conectado ao servidor');
                }
            } catch (error) {
                responseElement.textContent = `‚ùå ERRO: ${error.message}
TIMESTAMP: ${new Date().toLocaleString('pt-BR')}
ENDPOINT: ${endpoint}`;
                
                updateConnectionStatus('error', 'Erro de conex√£o');
            }
        }
        
        // Fun√ß√£o para testar todas as APIs
        async function testAllAPIs() {
            const responseElement = document.getElementById('complete-response');
            responseElement.textContent = '‚è≥ Testando todas as APIs...\n\n';
            
            const endpoints = [
                '/health',
                '/api/painel/dados',
                '/api/painel/executivo',
                '/api/painel/fluxo',
                '/api/painel/usuarios',
                '/api/painel/alertas'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    responseElement.textContent += `üîç Testando ${endpoint}...\n`;
                    const response = await fetch(baseURL + endpoint);
                    const data = await response.json();
                    
                    responseElement.textContent += `‚úÖ ${endpoint}: ${response.status} - ${data.success ? 'OK' : 'ERRO'}\n`;
                    
                    if (data.usuarios) {
                        responseElement.textContent += `   üìä Usu√°rios: ${data.usuarios.total || 0}\n`;
                    }
                    if (data.ordens) {
                        responseElement.textContent += `   üìà Ordens: ${data.ordens.total || 0}\n`;
                    }
                    if (data.posicoes) {
                        responseElement.textContent += `   üíº Posi√ß√µes: ${data.posicoes.total || 0}\n`;
                    }
                    
                } catch (error) {
                    responseElement.textContent += `‚ùå ${endpoint}: ERRO - ${error.message}\n`;
                }
                
                responseElement.textContent += '\n';
            }
            
            responseElement.textContent += `\n‚úÖ TESTE COMPLETO FINALIZADO - ${new Date().toLocaleString('pt-BR')}`;
        }
        
        // Fun√ß√£o para atualizar status da conex√£o
        function updateConnectionStatus(type, message) {
            const statusElement = document.getElementById('connection-status');
            statusElement.className = `status ${type}`;
            statusElement.textContent = `${type === 'success' ? '‚úÖ' : '‚ùå'} ${message} - ${new Date().toLocaleString('pt-BR')}`;
        }
        
        // Verificar conex√£o inicial
        window.onload = function() {
            testAPI('/health', 'health-response');
        };
        
        // Auto-refresh do health check a cada 30 segundos
        setInterval(() => {
            fetch(baseURL + '/health')
                .then(response => {
                    if (response.ok) {
                        updateConnectionStatus('success', 'Sistema Online');
                    } else {
                        updateConnectionStatus('error', 'Servidor com problemas');
                    }
                })
                .catch(() => {
                    updateConnectionStatus('error', 'Servidor offline');
                });
        }, 30000);
    </script>
</body>
</html>

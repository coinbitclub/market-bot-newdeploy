COINBITCLUB - MARKETBOT

Introdu√ß√£o e Contextualiza√ß√£o do Projeto
O CoinbitClub MarketBot √© um sistema enterprise, multiusu√°rio, projetado para operar simultaneamente em testnet e mainnet nas corretoras Binance e Bybit, com foco absoluto em seguran√ßa, escalabilidade e automa√ß√£o inteligente.
Seu n√∫cleo √© impulsionado por IA especializada em trading em tempo real, capaz de interpretar dados de mercado, aplicar regras t√©cnicas e executar ordens com controle total de risco.
O sistema engloba:
‚Ä¢	Execu√ß√£o automatizada de ordens com base em sinais externos e na an√°lise inteligente da IA.
‚Ä¢	Suporte multiusu√°rio com m√∫ltiplas chaves API por conta (produ√ß√£o e testnet) com identifica√ß√£o autom√°tica do tipo de chave.
‚Ä¢	Pain√©is administrativos e de usu√°rio integrados, sem uso de dados mock.
‚Ä¢	Sistema financeiro completo (planos, comiss√µes, saldo pr√©-pago, saques e bonifica√ß√µes).
‚Ä¢	Rotinas autom√°ticas para monitoramento, limpeza, auditoria e orquestra√ß√£o dos servi√ßos.
‚Ä¢	O backend esta no Railways.

Objetivo Geral
‚Ä¢	Entregar todo o sistema esteja funcional, operando com dados reais e refletindo em tempo real o estado do backend e da infraestrutura.
‚Ä¢	
Garantir que o CoinbitClub MarketBot est√° pronto para operar em ambiente real  24/7, com alta disponibilidade, seguran√ßa refor√ßada e zero depend√™ncia de dados n√£o integrados.

GEST√ÉO DE USU√ÅRIOS

**REQUISITOS FUNCIONAIS DETALHADOS**

**1. SISTEMA MULTIN√çVEL DE USU√ÅRIOS**

1.1 Perfis de Usu√°rio

- **ADMIN**: Acesso completo ao sistema administrativo
- **GESTOR**: Gest√£o operacional e controle de usu√°rios
- **OPERADOR**: Opera√ß√µes de trading e monitoramento
- **AFFILIATE_VIP**: Afiliado com comiss√£o 5% (nomeado pelo ADMIN)
- **AFFILIATE**: Afiliado padr√£o com comiss√£o 1.5% (nomeado automaticamente mediante solicita√ß√£o)
OBS: Todos os usu√°rios v√£o ter os mesmo perfil e acesso as funcionalidades. O que muda apenas √© o % de comiss√£o sobre o resultado de acordo com o plano.

### **.2 Hierarquia e Permiss√µes**

- Sistema de roles baseado em `user_type`
- Controle de acesso granular por funcionalidade
- Redirecionamento autom√°tico baseado no perfil
- Middleware de autentica√ß√£o com valida√ß√£o de permiss√µes

### **2. SISTEMA DE AUTENTICA√á√ÉO E SEGURAN√áA**

### **2.1 Autentica√ß√£o**

- Login com email e senha
- Hash de senha com bcrypt
- Tokens JWT para sess√µes
- Verifica√ß√£o de email obrigat√≥ria
- Sistema de recupera√ß√£o de senha via SMS

### **2.2 Seguran√ßa**

- Two-factor authentication (2FA)
- Verifica√ß√£o de telefone
- Controle de sess√µes
- Logs de auditoria de login
- Bloqueio por tentativas excessivas

### **3. SISTEMA DE AFILIA√á√ÉO**

### **3.1 Estrutura de Afiliados**

- C√≥digos √∫nicos de afiliado (formato: CBC + 6 caracteres)
- Sistema de refer√™ncia hier√°rquico
- Comiss√µes diferenciadas por n√≠vel:
    - **AFFILIATE**: 1.5% de comiss√£o
    - **AFFILIATE_VIP**: 5% de comiss√£o
- Convers√£o autom√°tica de comiss√£o em cr√©ditos (+10% b√¥nus)

### **3.2 Funcionalidades de Afiliado**

- Dashboard de comiss√µes
- Hist√≥rico de indica√ß√µes
- Relat√≥rios de performance
- Links personalizados
- Materiais de marketing

### **4. CONFIGURA√á√ïES PERSONALIZADAS**

### **4.1 Configura√ß√µes de Trading**

- Limites de posi√ß√µes simult√¢neas
- Limite de perda di√°ria
- Tamanho m√°ximo de posi√ß√£o
- Alavancagem personalizada
- Stop loss e take profit padr√£o
- Modo testnet/mainnet (priorit√°rio)
Nota: OBRIAT√ìRIO ABRIR AS OPERA√á√ïES COM TAKE PROFIT e STOP LOSS - O sistema trabalhar√° em default (modo personaliz√°vel pelo adm) se n√£o houver personaliza√ß√£o pelo usuario. Como funciona: Alavancagem = 5x (Personaliz√°vel: at√© 10x) Take profit = 3x alavancagem = 15 (Personaliz√°vel: at√© 5x) Stop Loss = 2x alavancagem = 10 (Personaliz√°vel: 2 - 4x) Tamanho da posi√ß√£o = 30% saldo da exchange (Personaliz√°vel: 10% a 50%)

4.2 Configura√ß√µes de Notifica√ß√£o
Relat√≥rios di√°rios/semanais/mensais

5. GEST√ÉO DE SALDOS
5.1 Tipos de Saldo
‚Ä¢	Saldo Real BRL: Saldo em reais para opera√ß√µes
‚Ä¢	Saldo Real USD: Saldo em d√≥lares para opera√ß√µes
‚Ä¢	Saldo Administrativo BRL: Cr√©ditos administrativos em reais
‚Ä¢	Saldo Administrativo USD: Cr√©ditos administrativos em d√≥lares
‚Ä¢	Saldo de Comiss√£o BRL: Comiss√µes acumuladas em reais
‚Ä¢	Saldo de Comiss√£o USD: Comiss√µes acumuladas em d√≥lares

5.2 Controle Financeiro
‚Ä¢	Limites de saque di√°rio por perfil
‚Ä¢	Limites de valor por opera√ß√£o
‚Ä¢	Controle de transa√ß√µes
‚Ä¢	Hist√≥rico de movimenta√ß√µes
‚Ä¢	Auditoria financeira

Integra√ß√£o de Pagamentos
üìã Requisitos Funcionais Detalhados
Se cliente sem assinatura e sem saldo, apenas TESTNET √© habilitado. Abertura de opera√ß√µes mainment apenas para clientes com saldo > ao saldo m√≠nimo em USD e BLR. Se a opera√ß√£o encerrar e o cliente n√£o tiver saldo suficiente para cobrir a comiss√£o fica com saldo devedor que dever√° ser compensado na pr√≥xima recarga.
Sistema trabalha por assinatura + comiss√£o reduzida sobre o resultado positivo das opera√ß√µes (10%) ou apenas por pr√© pago (sem mensalidade) com comiss√£o 20%  sobre o resultado positivo das opera√ß√µes.

üéØ 1. Sistema de Assinaturas Stripe
1.1 Planos de Assinatura
‚Ä¢	Brasil: R$ 297,00/m√™s (assinatura)
‚Ä¢	Exterior: $50.00/m√™s (assinatura)
‚Ä¢	Recargas: Valores customiz√°veis (m√≠nimo R$ 150 / $30)
‚Ä¢	Suporte a m√∫ltiplas moedas: BRL (Brasil) e USD (Internacional)
1.2 Funcionalidades de Assinatura
‚Ä¢	‚úÖ Cria√ß√£o autom√°tica de checkout sessions
‚Ä¢	‚úÖ Processamento de webhooks para renova√ß√µes
‚Ä¢	‚úÖ Cancelamento e reativa√ß√£o de assinaturas
‚Ä¢	‚úÖ Per√≠odo trial gratuito (7 dias)
‚Ä¢	‚úÖ Upgrade/downgrade entre planos
‚Ä¢	‚úÖ Hist√≥rico completo de pagamentos

2. Sistema de Recargas
2.1 Tipos de Recarga
‚Ä¢	Recarga Flex√≠vel: Valor m√≠nimo R$ 150,00 / USD30
‚Ä¢	Recarga com B√¥nus: +10% de b√¥nus em recargas acima de R$ 1.000/USD300
‚Ä¢	Suporte a PIX: Pagamento instant√¢neo
‚Ä¢	Suporte a Cart√£o: Cr√©dito e d√©bito
2.2 Processamento de Recargas
‚Ä¢	‚úÖ C√°lculo autom√°tico de comiss√µes
‚Ä¢	‚úÖ Credita√ß√£o imediata ap√≥s confirma√ß√£o
‚Ä¢	‚úÖ Valida√ß√£o de valores m√≠nimos/m√°ximos
‚Ä¢	‚úÖ Hist√≥rico de transa√ß√µes
‚Ä¢	‚úÖ Notifica√ß√µes por SMS

3. Sistema de Cupons Administrativos

‚Ä¢	‚úÖ Gera√ß√£o autom√°tica de c√≥digos √∫nicos
‚Ä¢	Gera√ß√£o por cr√©dito diretor em valor em R$ / USD ou % de desconto.
‚Ä¢	‚úÖ Valida√ß√£o de expira√ß√£o (30 dias)
‚Ä¢	‚úÖ Uso √∫nico por cupom
‚Ä¢	‚úÖ Aplica√ß√£o direta no saldo administrativo
‚Ä¢	‚úÖ Log completo de uso
‚Ä¢	‚úÖ Controle de IP, N¬∫ TELEFONE e User-Agent

4. Sistema de Comiss√µes e Afiliados
OBS: As opera√ß√µes s√£o realizadas em d√≥lar. No caso dos usu√°rios com plano Brasil, ser√° necess√°rio fazer a convers√£o utilizando o cambio do dia para descontar no valor da recarga.
Comiss√µes sobre LUCRO (apenas opera√ß√µes lucrativas)
PLANO MENSAL: 10% de comiss√£o PLANO PR√â-PAGO: 20% de comiss√£o // Comiss√µes de Afiliados (sobre a comiss√£o da empresa)
AFILIADO NORMAL: 1.5% da comiss√£o total AFILIADO VIP: 5.0% da comiss√£o total
Exemplo: A opera√ß√£o ocorre direto na conta da operadora. Ent√£o, a nossa √∫nica forma de receber pelo servi√ßo √© desconto do saldo de recarga. O lucro ser√° em USD. Se o lucro foi USD 100 precisamos converter para BRL (ex. 5,25) = 525,00. Comiss√£o empresa: 517,12 Comiss√£o afiliado normal: R$7,87.
4.1 Funcionalidades
‚Ä¢	‚úÖ C√°lculo autom√°tico p√≥s-operacao
‚Ä¢	‚úÖ Distribui√ß√£o autom√°tica para afiliados
‚Ä¢	‚úÖ Convers√£o de comiss√µes para cr√©ditos (+10% b√¥nus)
‚Ä¢	‚úÖ Hist√≥rico detalhado de comiss√µes
‚Ä¢	‚úÖ Dashboard de afiliados

5.2 Regras de Saque

SALDO REAL (Stripe): ‚úÖ PODE SACAR SALDO ADMINISTRATIVO: ‚ùå N√ÉO PODE SACAR SALDO COMISS√ÉO: ‚ùå N√ÉO PODE SACAR (pode converter)

5.2 Regras de Saque
‚Ä¢	Valor m√≠nimo: R$ 50,00 (BRL) / $10,00 (USD)
‚Ä¢	Vamos cobrar taxa de saque de R$10 ou USD2
‚Ä¢	Valida√ß√£o de dados banc√°rios obrigat√≥ria
‚Ä¢	Aprova√ß√£o manual por administrador
‚Ä¢	Processamento em at√© 48h √∫teis
‚Ä¢	Notifica√ß√£o de status por sms
‚Ä¢	se usu√°rio/afiliado tiver saldo pode ser aprovado automaticamente, automaticamente. 
‚Ä¢	Datas de pagamento de ordens solicitadas: dias 05 e 20 de cada m√™s.

SISTEMA FINANCEIRO
üéØ REQUISITOS FUNCIONAIS DETALHADOS
1. GEST√ÉO DE SALDOS
1.1 Tipos de Saldo
‚Ä¢	Saldo Real (Stripe) 
o	Origem: Pagamentos via Stripe (ap√≥s desconto de comiss√£o)
o	Caracter√≠stica: PODE SACAR
o	Moedas: BRL e USD
‚Ä¢	Saldo Administrativo (Cupons) 
o	Origem: Cupons promocionais criados pelo admin
o	Caracter√≠stica: N√ÉO PODE SACAR, v√°lido por 30 dias
o	Moedas: BRL e USD
o	Uso: Opera√ß√µes reais no sistema
‚Ä¢	Saldo Comiss√£o (Afiliados) 
o	Origem: Comiss√µes sobre lucro de usu√°rios indicados
o	Caracter√≠stica: PODE SACAR e/ou pode converter com bonus +10%
o	Moedas: BRL e USD
o	Convers√£o: R$ 100 comiss√£o ‚Üí R$ 110 cr√©dito administrativo
1.2 Opera√ß√µes de Saldo
‚Ä¢	Consulta de saldos por usu√°rio
‚Ä¢	Atualiza√ß√£o autom√°tica ap√≥s transa√ß√µes
‚Ä¢	Valida√ß√£o de saldo antes de opera√ß√µes
‚Ä¢	Hist√≥rico de movimenta√ß√µes
‚Ä¢	Convers√£o entre moedas (BRL ‚ÜîÔ∏é USD)

2. SISTEMA DE COMISSIONAMENTO
2.1 Planos de Assinatura
PLANO MENSAL:     10% de comiss√£o sobre LUCRO
PLANO PR√â-PAGO:   20% de comiss√£o sobre LUCRO
2.2 Sistema de Afiliados
AFILIADO NORMAL:  1.5% da comiss√£o da empresa
AFILIADO VIP:     5.0% da comiss√£o da empresa
2.3 Regras de Comissionamento
‚Ä¢	Cobran√ßa APENAS em opera√ß√µes com LUCRO
‚Ä¢	Sem cobran√ßa em opera√ß√µes com preju√≠zo
‚Ä¢	C√°lculo autom√°tico ap√≥s fechamento de opera√ß√£o
‚Ä¢	Distribui√ß√£o autom√°tica para afiliados
‚Ä¢	Registro de todas as comiss√µes

3. INTEGRA√á√ÉO STRIPE
3.1 Planos Dispon√≠veis
‚Ä¢	Brasil: R$ 297,00/m√™s (assinatura)
‚Ä¢	Exterior: $50.00/m√™s (assinatura)
‚Ä¢	Recargas: Valores customiz√°veis (m√≠nimo R$ 150 / $30)
3.2 Webhooks Stripe
‚Ä¢	Processamento autom√°tico de pagamentos
‚Ä¢	Confirma√ß√£o de assinaturas
‚Ä¢	Cancelamento de assinaturas
‚Ä¢	Falhas de pagamento
‚Ä¢	Reembolsos
3.3 Fluxo de Pagamento
1.	Cria√ß√£o de sess√£o de checkout
2.	Processamento do pagamento
3.	Aplica√ß√£o de comiss√£o
4.	Credita√ß√£o do saldo real
5.	Notifica√ß√£o ao usu√°rio

4. SISTEMA DE CUPONS ADMINISTRATIVOS
4.1 Tipos de Cupons
‚Ä¢	BASIC: R$ 200,00 / $35.00
‚Ä¢	PREMIUM: R$ 500,00 / $100.00
‚Ä¢	VIP: R$ 1.000,00 / $200.00
‚Ä¢	Ou % de desconto
4.2 Funcionalidades
‚Ä¢	Gera√ß√£o autom√°tica de c√≥digos √∫nicos
‚Ä¢	Valida√ß√£o de cupons
‚Ä¢	Controle de expira√ß√£o (30 dias)
‚Ä¢	Uso √∫nico por usu√°rio
‚Ä¢	Log completo de utiliza√ß√£o
4.3 Processo de Uso
1.	Admin gera cupom
2.	Usu√°rio insere c√≥digo
3.	Sistema valida cupom

4.	Cr√©dito aplicado no saldo administrativo
5.	Cupom marcado como usado

5. SISTEMA DE SAQUES
5.1 Regras de Saque
‚úÖ PODE SACAR:     Apenas saldo REAL (origem Stripe)
‚ùå N√ÉO PODE SACAR: Saldo administrativo (cupons)
‚ùå N√ÉO PODE SACAR: Saldo comiss√£o (pode converter +10%)
5.2 Processo de Saque
1.	Usu√°rio solicita saque
2.	Valida√ß√£o de saldo dispon√≠vel
3.	Verifica√ß√£o de dados banc√°rios
4.	Cria√ß√£o de solicita√ß√£o pendente
5.	Aprova√ß√£o administrativa
6.	Processamento da transfer√™ncia
7.	Confirma√ß√£o ao usu√°rio
5.3 Valida√ß√µes
‚Ä¢	Saldo m√≠nimo para saque
‚Ä¢	Dados banc√°rios obrigat√≥rios
‚Ä¢	Limite de saques por per√≠odo
‚Ä¢	Aprova√ß√£o obrigat√≥ria por admin

6. SISTEMA DE AFILIADOS
6.1 Tipos de Afiliado
‚Ä¢	Normal: 1.5% da comiss√£o da empresa
‚Ä¢	VIP: 5.0% da comiss√£o da empresa
6.2 Funcionalidades
‚Ä¢	Vincula√ß√£o de usu√°rios (at√© 48h ap√≥s cadastro)
‚Ä¢	C√°lculo autom√°tico de comiss√µes
‚Ä¢	Convers√£o de comiss√£o em cr√©dito (+10% b√¥nus)
‚Ä¢	Relat√≥rios de performance
‚Ä¢	Controle de pagamentos
6.3 Convers√£o de Comiss√£o
‚Ä¢	Processo autom√°tico
‚Ä¢	Registro da transa√ß√£o
‚Ä¢	Notifica√ß√£o ao afiliado

DADOS NECESS√ÅRIOS NO BANCO
1. DADOS DE USU√ÅRIOS
1.1 Informa√ß√µes B√°sicas
‚Ä¢	ID √∫nico do usu√°rio
‚Ä¢	Nome completo
‚Ä¢	Email
‚Ä¢	Senha (hash)
‚Ä¢	Pa√≠s (BR/US)
‚Ä¢	Tipo de plano (MONTHLY/PREPAID/NONE)
‚Ä¢	Tipo de afiliado (normal/vip/none)
‚Ä¢	ID do afiliador (se aplic√°vel)
‚Ä¢	Status da conta (ativo/inativo)
1.2 Saldos
‚Ä¢	Saldo real BRL
‚Ä¢	Saldo real USD
‚Ä¢	Saldo administrativo BRL
‚Ä¢	Saldo administrativo USD
‚Ä¢	Saldo comiss√£o BRL
‚Ä¢	Saldo comiss√£o USD
1.3 Dados Stripe
‚Ä¢	Customer ID do Stripe
‚Ä¢	Subscription ID do Stripe
‚Ä¢	Status da assinatura
‚Ä¢	Data de in√≠cio da assinatura
‚Ä¢	Data de fim da assinatura
1.4 Dados Banc√°rios
‚Ä¢	Nome do banco
‚Ä¢	Ag√™ncia
‚Ä¢	Conta
‚Ä¢	CPF (Brasil)
‚Ä¢	Dados PIX

2. DADOS DE TRANSA√á√ïES
2.1 Transa√ß√µes Financeiras
‚Ä¢	ID da transa√ß√£o
‚Ä¢	ID do usu√°rio
‚Ä¢	Tipo de transa√ß√£o
‚Ä¢	Valor
‚Ä¢	Moeda
‚Ä¢	Status
‚Ä¢	Valor da comiss√£o
‚Ä¢	Valor l√≠quido
‚Ä¢	Tipo de plano
‚Ä¢	Descri√ß√£o
‚Ä¢	Data de cria√ß√£o
‚Ä¢	Data de atualiza√ß√£o

2.2 Registros de Comiss√£o
‚Ä¢	ID do registro
‚Ä¢	ID do usu√°rio
‚Ä¢	ID da opera√ß√£o (se aplic√°vel)
‚Ä¢	Valor da comiss√£o
‚Ä¢	Moeda
‚Ä¢	Tipo de comiss√£o
‚Ä¢	Taxa aplicada
‚Ä¢	Valor do lucro
‚Ä¢	Descri√ß√£o
‚Ä¢	Data de cria√ß√£o
3. DADOS DE CUPONS
3.1 Cupons Administrativos
‚Ä¢	ID do cupom
‚Ä¢	C√≥digo √∫nico
‚Ä¢	Tipo de cr√©dito
‚Ä¢	Valor
‚Ä¢	Moeda
‚Ä¢	ID do admin criador
‚Ä¢	ID do usu√°rio que usou
‚Ä¢	Status (usado/n√£o usado)
‚Ä¢	Data de cria√ß√£o
‚Ä¢	Data de uso
‚Ä¢	Data de expira√ß√£o
‚Ä¢	Descri√ß√£o
‚Ä¢	Metadados
3.2 Logs de Uso de Cupons
‚Ä¢	ID do log
‚Ä¢	C√≥digo do cupom
‚Ä¢	ID do usu√°rio
‚Ä¢	A√ß√£o realizada
‚Ä¢	Valor
‚Ä¢	Moeda
‚Ä¢	IP de origem
‚Ä¢	User-Agent
‚Ä¢	Data de cria√ß√£o
4. DADOS DE SAQUES
4.1 Solicita√ß√µes de Saque
‚Ä¢	ID da solicita√ß√£o
‚Ä¢	ID do usu√°rio
‚Ä¢	Valor
‚Ä¢	Moeda
‚Ä¢	Status
‚Ä¢	Data da solicita√ß√£o
‚Ä¢	Data do processamento
‚Ä¢	ID do admin processador
‚Ä¢	Observa√ß√µes do admin
‚Ä¢	Dados banc√°rios
‚Ä¢	ID da transa√ß√£o banc√°ria

5. DADOS DE AFILIADOS
5.1 Afiliados
‚Ä¢	ID do afiliado
‚Ä¢	ID do usu√°rio
‚Ä¢	C√≥digo de afiliado
‚Ä¢	C√≥digo de refer√™ncia usado
‚Ä¢	Taxa de comiss√£o
‚Ä¢	Status
‚Ä¢	Total de refer√™ncias
‚Ä¢	Total de ganhos
‚Ä¢	Pagamentos pendentes
‚Ä¢	Total pago
‚Ä¢	Data de cria√ß√£o
‚Ä¢	Data de atualiza√ß√£o

5.2 Comiss√µes de Afiliados
‚Ä¢	ID da comiss√£o
‚Ä¢	ID do afiliado
‚Ä¢	ID do usu√°rio referenciado
‚Ä¢	ID da opera√ß√£o de trading
‚Ä¢	Valor
‚Ä¢	Percentual
‚Ä¢	Tipo
‚Ä¢	Status
‚Ä¢	Lucro do usu√°rio
‚Ä¢	Data do pagamento
‚Ä¢	Data de cria√ß√£o
‚Ä¢	Data de atualiza√ß√£o
6. DADOS DE CONFIGURA√á√ÉO
6.1 Configura√ß√µes do Sistema
‚Ä¢	Chave da configura√ß√£o
‚Ä¢	Valor
‚Ä¢	Descri√ß√£o
‚Ä¢	ID do usu√°rio que atualizou
‚Ä¢	Data de atualiza√ß√£o
6.2 Produtos Stripe
‚Ä¢	ID do produto
‚Ä¢	ID do produto no Stripe
‚Ä¢	ID do pre√ßo no Stripe
‚Ä¢	Nome
‚Ä¢	Descri√ß√£o
‚Ä¢	Tipo
‚Ä¢	Valor
‚Ä¢	Moeda
‚Ä¢	Intervalo
‚Ä¢	Taxa de comiss√£o
‚Ä¢	Valor m√≠nimo
‚Ä¢	Link de pagamento
‚Ä¢	Status ativo
‚Ä¢	Data de cria√ß√£o
‚Ä¢	Data de atualiza√ß√£o







FLUXO OPERACIONAL

O primeiro passo antes de abrir as opera√ß√µes nas Exchange √© realizar a leitura do mercado. Atrav√©s desse passo o sistema estabelecer√° os crit√©rios para processamento dos sinais e que tipo de opera√ß√µes LONG, SHORT ou  LONG e/ou SHORT ser√£o abertas.

1)	LEITURA DO MERCADO

Fear & Greed Index ‚Äì 0- 100
1)	<30 = LONG ‚Äì Somente opera√ß√µes LONG (an√°lise IA informativa ‚Äì confirma, mas n√£o interfere)
2)	>80 = SHORT ‚Äì Somente opera√ß√µes SHORT (an√°lise IA informativa ‚Äì confirma, mas n√£o interfere)
3)	30-80 = NEUTRO - Opera√ß√µes LONG e/ou SHORT, an√°lise IA interfere considerando:
TOP 100 Binance -  Market Pulse - TOP 100:

Coleta de dados 

‚Ä¢ TOP 100 pares USDT por volume 
‚Ä¢ Para cada moeda: ‚ó¶ Pre√ßo atual ‚ó¶ Varia√ß√£o 24h (%) ‚ó¶ Volume negociado 

C√°lculos principais 

PM+=Moedas com Œî24h > 0100√ó100PM+ = \frac{\text{Moedas com Œî24h > 0}}{100} \times 100PM+=100Moedas com Œî24h > 0√ó100 

% Moedas Negativas (PM‚Äì)

PM‚àí=100‚àíPM+PM- = 100 - PM+PM‚àí=100‚àíPM+ 

Varia√ß√£o Ponderada por Volume (VWŒî)

VWŒî=‚àë(Œî24h√óVolume)‚àëVolumeVWŒî = \frac{\sum (Œî_{24h} \times Volume)}{\sum Volume}VWŒî=‚àëVolume‚àë(Œî24h√óVolume) 

REGRAS DE DECIS√ÉO:

‚Ä¢ Somente opera√ß√µes LONG: PM+ ‚â• 60% e VWŒî > 0,5% 
‚Ä¢ Somente opera√ß√µes SHORT: PM‚Äì ‚â• 60% e VWŒî < ‚Äì0,5%
‚Ä¢ Opera√ß√µes LONG E SHORT: PM+ entre 40% e 60% ou VWŒî entre ‚Äì0,5% e +0,5% 

Exemplo:
Market Pulse 100 (30min): - Moedas positivas: 68% - VWŒî: +1.2% => Dire√ß√£o LONG 
Market Pulse 100 (45min): - Moedas positivas: 42% - VWŒî: ‚Äì0.7% => Dire√ß√£o SHORT 
Market Pulse 100 (15min): - Moedas positivas: 52% - VWŒî: +0.2% => Dire√ß√£o LONG E SHORT



2)	Recebimento de Webhooks e Sinais

1. RECEBIMENTO DE SINAIS
1.1 Endpoint TradingView
‚Ä¢	URL: POST /api/webhooks/signal
‚Ä¢	URL Alternativa: POST /webhook
‚Ä¢	Content-Type: application/json
‚Ä¢	Autentica√ß√£o: Bearer Token (opcional)
‚Ä¢	Rate Limiting: 300 requisi√ß√µes por hora por IP
‚Ä¢	Sinais para abertura de opera√ß√µes: "SINAL LONG FORTE" OU "SINAL SHORT FORTE"
‚Ä¢	Sinais para fechamento de opera√ß√µes: "FECHE LONG" OU "FECHE SHORT"

1.2 Valida√ß√£o de Dados
‚Ä¢	Campos Obrigat√≥rios: 
o	symbol (string): Par de trading (ex: ‚ÄúBTCUSDT‚Äù)
o	action (string): A√ß√£o a executar (‚ÄúBUY‚Äù, ‚ÄúSELL‚Äù, ‚ÄúSTRONG_BUY‚Äù, ‚ÄúSTRONG_SELL‚Äù)
‚Ä¢	Campos Opcionais: 
o	price (number): Pre√ßo do ativo
o	quantity (number): Quantidade a negociar
o	strategy (string): Nome da estrat√©gia
o	timeframe (string): Timeframe do gr√°fico
o	alert_message (string): Mensagem personalizada
o	rsi (number): Valor do RSI
o	macd (number): Valor do MACD
o	volume (number): Volume de negocia√ß√£o

1.3 Janela de Valida√ß√£o
‚Ä¢	Tempo de Valida√ß√£o: 30 segundos
‚Ä¢	Tempo de Execu√ß√£o: 120 segundos (2 minutos)
‚Ä¢	Expira√ß√£o: Sinais expirados s√£o rejeitados automaticamente

1.4 Processamento Autom√°tico
‚Ä¢	Valida√ß√£o IA: An√°lise de confian√ßa via OpenAI
‚Ä¢	An√°lise de Mercado: Fear & Greed Index, domin√¢ncia BTC, RSI
‚Ä¢	Execu√ß√£o Multi-Usu√°rio: Processamento para todos os usu√°rios ativos e com saldo (stripe ou administrativo para manment) / se conta testner n√£o precisa ter saldo.
‚Ä¢	Notifica√ß√µes: Alertas para sinais fortes (STRONG_BUY/STRONG_SELL)

1.4 Processamento Autom√°tico
‚Ä¢	Valida√ß√£o IA: An√°lise de confian√ßa via OpenAI (necess√°rio otimizar a quantidade de chamados)
‚Ä¢	Leitura do mercado
2. SISTEMA DE VALIDA√á√ÉO
2.1 Valida√ß√£o de Seguran√ßa
‚Ä¢	Rate Limiting: 300 req/hora por IP
‚Ä¢	Autentica√ß√£o: Bearer token (TRADINGVIEW_WEBHOOK_SECRET)
‚Ä¢	Schema Validation: Valida√ß√£o JSON obrigat√≥ria
‚Ä¢	Sanitiza√ß√£o: Limpeza de dados de entrada a cada 2h

2.2 Valida√ß√£o de Mercado
‚Ä¢	Valida√ß√£o IA: An√°lise de confian√ßa via OpenAI (necess√°rio otimizar a quantidade de chamados)
‚Ä¢	Leitura do mercado

2.3 Valida√ß√£o de Risco
Configura√ß√µes default ou personaliza√ß√£o do usu√°rio.

3. EXECU√á√ÉO DE ORDENS
3.1 Processamento Multi-Usu√°rio
‚Ä¢	Busca de Usu√°rios Ativos: Filtro por status e plano
‚Ä¢	Configura√ß√µes Personalizadas: Sizing e leverage por usu√°rio
‚Ä¢	Execu√ß√£o Paralela: Processamento simult√¢neo
‚Ä¢	Fallback: Sistema de emerg√™ncia para IP fixo
3.2 Integra√ß√£o com Exchanges (IP fixo)
‚Ä¢	Bybit: contratos perp√©tuos usdt
‚Ä¢	Binance: contratos perp√©tuos usdt
‚Ä¢	Auto-Routing: Sele√ß√£o baseada em liquidez e lat√™ncia
‚Ä¢	Ambiente: Testnet e Mainnet simult√¢neos
3.3 Monitoramento de Execu√ß√µes
‚Ä¢	Status Tracking: PENDING, PROCESSING, SUCCESS, FAILED
‚Ä¢	Retry Logic: Tentativas autom√°ticas em caso de falha (aten√ß√£o a validade do sinal)
‚Ä¢	Logs Detalhados: Rastreamento completo de execu√ß√µes
‚Ä¢	M√©tricas: Performance e estat√≠sticas em tempo real

Sistema de Intelig√™ncia Artificial

1. AN√ÅLISE OPENAI GPT-4
1.1 Funcionalidades Principais
‚Ä¢	‚úÖ An√°lise de Mercado em Tempo Real: Processamento de dados de mercado via OpenAI GPT-4
‚Ä¢	‚úÖ Prompts Estruturados: Templates padronizados para decis√µes de trading
‚Ä¢	‚úÖ Regras de Decis√£o: Sistema baseado em m√∫ltiplos indicadores t√©cnicos
‚Ä¢	‚úÖ Fallback Inteligente: Sistema de backup sem IA em caso de falha
‚Ä¢	‚úÖ Detec√ß√£o de Diverg√™ncias: Identifica√ß√£o de inconsist√™ncias de mercado
1.2 Prompts Estruturados para Decis√µes
const decisionPrompt = 
üéØ AN√ÅLISE QUANTITATIVA DE MERCADO ‚Äì MARKETBOT ================================================ Voc√™ √© um especialista em trading quantitativo de criptomoedas. Sua fun√ß√£o √© analisar os dados e tamb√©m monitorar opera√ß√µes abertas. üìä DADOS DISPON√çVEIS: - Fear & Greed Index atual: {{fear_greed.valor}} (classifica√ß√£o: {{fear_greed.classificacao}}) - Dire√ß√£o F&G permitida: {{fear_greed.direcao}} - Market Pulse TOP100  ‚Ä¢ % Moedas positivas: {{market.pct_positivas}}% ‚Ä¢ % Moedas negativas: {{market.pct_negativas}}% ‚Ä¢ Varia√ß√£o Ponderada por Volume (VWŒî): {{market.vwdelta}}% - Domin√¢ncia BTC: ‚Ä¢ Valor atual: {{btc.dominancia}}% ‚Ä¢ Tend√™ncia: {{btc.tendencia}} (subindo/caindo/est√°vel) üìê REGRAS DE AN√ÅLISE: 1. **Fear & Greed prevalece sempre**: - F&G < 30 ‚Üí SOMENTE_LONG - F&G > 80 ‚Üí SOMENTE_SHORT - F&G entre 30‚Äì80 ‚Üí NEUTRO (seguir an√°lise t√©cnica) 2. **Market Pulse 100**: - LONG se PM+ ‚â• 60% e VWŒî > +0.5% - SHORT se PM‚Äì ‚â• 60% e VWŒî < ‚Äì0.5% - LONG_E_SHORT se 40% ‚â§ PM+ ‚â§ 60% ou ‚Äì0.5% ‚â§ VWŒî ‚â§ +0.5% 3. **Domin√¢ncia BTC**: - ‚â•50% e subindo ‚Üí Short Altcoins - ‚â§45% e caindo ‚Üí Long Altcoins - Est√°vel (<0,5% varia√ß√£o) ‚Üí Neutro 4. **Hist√≥rico (15/30/45 vs Now)**: - Se a dire√ß√£o atual divergir da tend√™ncia anterior, aplicar redu√ß√£o de confian√ßa (-20%) e marcar diverg√™ncia=true. 5. **Em diverg√™ncia entre indicadores**: - Fear & Greed prevalece. - Reduzir em 50% os par√¢metros personalizados de abertura. üì° MONITORAMENTO DE OPERA√á√ïES: - A IA deve monitorar continuamente TODAS as opera√ß√µes abertas. - Se receber o sinal **"FECHE_LONG"**, deve sugerir fechamento imediato de posi√ß√µes LONG abertas. - Se receber o sinal **"FECHE_SHORT"**, deve sugerir fechamento imediato de posi√ß√µes SHORT abertas. üì§ FORMATO DE RESPOSTA (somente JSON v√°lido): { "market_direction": "SOMENTE_LONG | SOMENTE_SHORT | LONG_E_SHORT", "confidence_level": 1-100, "reasoning": "string at√© 120 chars explicando decis√£o", "key_factors": ["fator1", "fator2", "fator3"], "market_moment": "classifica√ß√£o resumida do mercado", "divergencia_detectada": true/false, "reducao_parametros": true/false, "close_signal": "FECHE_LONG | FECHE_SHORT | NONE", "analysis_type": "openai_gpt4" }

2. REGRAS DE DECIS√ÉO BASEADAS EM M√öLTIPLOS INDICADORES
Fear & Greed prevalece sempre: - F&G < 30 ‚Üí SOMENTE_LONG - F&G > 80 ‚Üí SOMENTE_SHORT - F&G entre 30‚Äì80 ‚Üí NEUTRO (seguir an√°lise t√©cnica long e ou short)

2.2 Domin√¢ncia BTC (informativo)
- ‚â•50% e subindo ‚Üí Short Altcoins - ‚â§45% e caindo ‚Üí Long Altcoins - Est√°vel (<0,5% varia√ß√£o) ‚Üí Neutro (long e short)

2.3 Top 100 Performance - Market Pulse 100:
- LONG se PM+ ‚â• 60% e VWŒî > +0.5% - SHORT se PM‚Äì ‚â• 60% e VWŒî < ‚Äì0.5% - LONG_E_SHORT se 40% ‚â§ PM+ ‚â§ 60% ou ‚Äì0.5% ‚â§ VWŒî ‚â§ +0.5%

2.4 Detec√ß√£o de Diverg√™ncias
‚Ä¢	Diverg√™ncia detectada: Fear & Greed prevalece
‚Ä¢	Redu√ß√£o de par√¢metros: 50% dos valores de abertura
‚Ä¢	Aumento de cautela: Maior rigor na valida√ß√£o

3. FALLBACK SEM IA
3.1 Sistema de Fallback Inteligente
analiseFallback(fearGreedData, binanceData) {
    let direcao = 'NEUTRO';    let confianca = 0.6;    let justificativa = 'An√°lise baseada em Fear & Greed';    // Seguir regras Fear & Greed    if (fearGreedData.valor < 30) {
        direcao = 'LONG';        confianca = 0.8;        justificativa = 'F&G baixo indica medo extremo - oportunidade LONG';    } else if (fearGreedData.valor > 80) {
        direcao = 'SHORT';        confianca = 0.8;        justificativa = 'F&G alto indica gan√¢ncia extrema - sinal SHORT';    } else if (binanceData.percentual_positivas > 70) {
        direcao = 'LONG';        confianca = 0.7;        justificativa = 'Maioria das moedas positivas - tend√™ncia LONG';    } else if (binanceData.percentual_positivas < 30) {
        direcao = 'SHORT';        confianca = 0.7;        justificativa = 'Maioria das moedas negativas - tend√™ncia SHORT';    }
    return {
        direcao_final: direcao,        confianca: confianca,        divergencia_detectada: false,        reducao_parametros: false,        justificativa: justificativa,        tokens_usados: 0,        fonte: 'fallback'    };}
3.2 Crit√©rios de Fallback
‚Ä¢	3 Condi√ß√µes Favor√°veis: Execu√ß√£o autom√°tica
‚Ä¢	2 Condi√ß√µes Favor√°veis: Execu√ß√£o com sinal forte

4. DETEC√á√ÉO DE DIVERG√äNCIAS DE MERCADO
4.1 Tipos de Diverg√™ncia
‚Ä¢	Fear & Greed vs Top 100: Sentimento vs performance real
‚Ä¢	BTC Dominance vs Altcoins: Correla√ß√£o inversa
4.2 A√ß√µes em Caso de Diverg√™ncia
‚Ä¢	Fear & Greed prevalece: Regra principal
‚Ä¢	Redu√ß√£o de par√¢metros: 50% dos valores padr√£o
‚Ä¢	Aumento de cautela: Maior rigor na valida√ß√£o
‚Ä¢	Log detalhado: Registro para an√°lise posterior

Sistema de Execu√ß√£o de Ordens

1. EXECU√á√ÉO AUTOMATIZADA EM M√öLTIPLAS EXCHANGES
1.1 Exchanges Suportadas
‚Ä¢	‚úÖ Binance: Spot e Futures (testnet/mainnet)
‚Ä¢	‚úÖ Bybit: Unified Trading (testnet/mainnet)
‚Ä¢	‚úÖ Auto-detec√ß√£o de ambiente: Testnet/Mainnet autom√°tica
‚Ä¢	‚úÖ APIs mais recentes: Agosto 2025 (Binance v3, Bybit v5)
PRIOTIT√ÅRIO: mainnet
2. VALIDA√á√ïES DE RISCO (SALDO, ALAVANCAGEM, POSI√á√ïES)
- m√°ximo de 2 opera√ß√µes simultaneas por usu√°rio. - bloqueio de moeda por 120 min ap√≥s opera√ß√£o executada na conta. Ex. encerramos opera√ß√£o de BTC na conta da Maria. Ent√£o, na conta da Maria s√≥ pode abrir outra opera√ß√£o em BTC daqui a 120 min. - saldo recarga m√≠nimo - conta testnet ou mannte (mannte priorit√°ria)
3. STOP LOSS E TAKE PROFIT OBRIGAT√ìRIOS no registro da opera√ß√£o
conforme parametros default ou personalizados pelo usuario C√°lculo de Par√¢metros de Ordem F√≥rmulas SL (%) = alavancagem √ó SL_mult TP (%) = alavancagem √ó TP_mult Valor = saldo_exchange √ó %definido   ‚Ä¢ Par√¢metros Padr√£o/DEFAULT 1. ‚ó¶ Alavancagem: 5√ó ‚ó¶ SL = 2 √ó alavancagem (ex.: 10%) ‚ó¶ TP = 3 √ó alavancagem (ex.: 15%) ‚ó¶ Valor = 30% do saldo da conta   ‚Ä¢ Par√¢metros Customizados (valores totais permitidos pelo sistema) 1. ‚ó¶ Alavancagem: 10√ó de alavancagem ‚ó¶ SL = 2 a 5 √ó alavancagem = 50% ‚ó¶ TP = 6 √ó alavancagem = 60% ‚ó¶ Valor = 10% at√© 50% do saldo
4.  MONITORAMENTO DE POSI√á√ïES EM TEMPO REAL
Podem ser encerradas automaticamente pelo atingimento do cadastro (stop loss/take profit) ou por SINAL FECHE. cobran√ßa comiss√£o feita automaticamente ap√≥s o encerramento da posi√ß√£o.

6. EXECUTORES DISPON√çVEIS
6.1 Executor Principal (Enhanced Signal Processor)
‚Ä¢	Arquivo: enhanced-signal-processor-with-execution.js
‚Ä¢	Status: ‚úÖ ATIVO e CONFIGURADO
‚Ä¢	Funcionalidade: Processamento de sinais TradingView + execu√ß√£o real
‚Ä¢	Trading Real: Suporta ENABLE_REAL_TRADING=true
‚Ä¢	Exchanges: Bybit e Binance com CCXT
‚Ä¢	Seguran√ßa: TESTNET ativo para opera√ß√µes reais de teste
6.2 Executor Enterprise (Order Execution Engine V2)
‚Ä¢	Arquivo: order-execution-engine-v2.js
‚Ä¢	Status: ‚úÖ ENTERPRISE VERSION - SISTEMA AVAN√áADO
‚Ä¢	Funcionalidade: Sistema unificado com auto-detec√ß√£o
‚Ä¢	Features Avan√ßadas: 
o	Auto-detec√ß√£o testnet/mainnet
o	APIs mais recentes (Agosto 2025)
o	Valida√ß√£o autom√°tica de chaves
o	Sistema de cache para valida√ß√£o
o	Risk management integrado
‚Ä¢	Integra√ß√µes: PostgreSQL Railway, CCXT, valida√ß√£o de chaves
6. EXECUTORES DISPON√çVEIS
6.1 Executor Principal (Enhanced Signal Processor)
‚Ä¢	Arquivo: enhanced-signal-processor-with-execution.js
‚Ä¢	Status: ‚úÖ ATIVO e CONFIGURADO
‚Ä¢	Funcionalidade: Processamento de sinais TradingView + execu√ß√£o real
‚Ä¢	Trading Real: Suporta ENABLE_REAL_TRADING=true
‚Ä¢	Exchanges: Bybit e Binance com CCXT
‚Ä¢	Seguran√ßa: TESTNET ativo para opera√ß√µes reais de teste
6.2 Executor Enterprise (Order Execution Engine V2)
‚Ä¢	Arquivo: order-execution-engine-v2.js
‚Ä¢	Status: ‚úÖ ENTERPRISE VERSION - SISTEMA AVAN√áADO
‚Ä¢	Funcionalidade: Sistema unificado com auto-detec√ß√£o
‚Ä¢	Features Avan√ßadas: 
o	Auto-detec√ß√£o testnet/mainnet
o	APIs mais recentes (Agosto 2025)
o	Valida√ß√£o autom√°tica de chaves
o	Sistema de cache para valida√ß√£o
o	Risk management integrado
‚Ä¢	Integra√ß√µes: PostgreSQL Railway, CCXT, valida√ß√£o de chaves

# üèóÔ∏è AN√ÅLISE DETALHADA DOS SISTEMAS ENTERPRISE - COINBITCLUB v6.0.0

## üéØ OBJETIVO DA AN√ÅLISE

Esta an√°lise foi realizada para mapear **TODAS** as funcionalidades, integra√ß√µes e fluxos dos sistemas enterprise do CoinBitClub Market Bot, preparando a especifica√ß√£o t√©cnica atualizada do frontend para a equipe de desenvolvimento.

---

## üí∞ 1. SISTEMA FINANCEIRO - MAPEAMENTO COMPLETO

### üè¶ **Estrutura Financeira Enterprise**

#### **Tipos de Saldo (4 Categorias)**
1. **üü¢ SALDO REAL (Stripe)**
   - **Origem:** Pagamentos via Stripe ap√≥s desconto de comiss√£o
   - **Caracter√≠stica:** PODE SACAR
   - **Exemplo:** Recarga R$ 500 ‚Üí Comiss√£o 10% = R$ 50 ‚Üí Saldo Real = R$ 450

2. **üü° SALDO ADMINISTRATIVO (Cupons)**
   - **Origem:** Cupons promocionais criados pelo admin
   - **Caracter√≠stica:** N√ÉO PODE SACAR, v√°lido por 30 dias
   - **Uso:** Opera√ß√µes reais no sistema
   - **Exemplo:** Cupom WELCOME100 = R$ 100 de cr√©dito

3. **üî¥ SALDO COMISS√ÉO (Afiliados)**
   - **Origem:** Comiss√µes sobre lucro de usu√°rios indicados
   - **Caracter√≠stica:** N√ÉO PODE SACAR, pode converter com bonus +10%
   - **Convers√£o:** R$ 100 comiss√£o ‚Üí R$ 110 cr√©dito administrativo

4. **üîµ SALDO PR√â-PAGO (Recargas)**
   - **Origem:** Recargas com desconto autom√°tico
   - **Desconto por Volume:**
     - **Bronze:** R$ 1.000-5.000 (5% desconto)
     - **Prata:** R$ 5.000-10.000 (10% desconto)
     - **Ouro:** R$ 10.000+ (15% desconto)

### üí≥ **Sistema de Comissionamento**

#### **Planos de Assinatura**
- **PLANO MENSAL:** 10% de comiss√£o sobre LUCRO
- **PLANO PR√â-PAGO:** 20% de comiss√£o sobre LUCRO

#### **Sistema de Afiliados**
- **AFILIADO NORMAL:** 1.5% da comiss√£o da empresa
- **AFILIADO VIP:** 5.0% da comiss√£o da empresa

#### **Exemplo Pr√°tico**
```
Usu√°rio tem lucro de R$ 1.000 (Plano Mensal + Afiliado Normal):
‚Ä¢ Comiss√£o total: R$ 100 (10%)
‚Ä¢ Empresa fica com: R$ 85 (8.5%)
‚Ä¢ Afiliado recebe: R$ 15 (1.5%)
```

### üîó **Integra√ß√£o Stripe Real**

#### **Produtos Configurados**
1. **Brasil PRO:** R$ 297,00/m√™s
2. **Brasil FLEX:** 20% comiss√£o (sem mensalidade)
3. **Global PRO:** $50,00/m√™s
4. **Global FLEX:** 20% comiss√£o (sem mensalidade)

#### **Fluxo de Pagamento**
```javascript
POST /api/enterprise/subscribe/brasil-pro
{
    "userId": "123",
    "customerEmail": "usuario@teste.com"
}
// Retorna: { checkoutUrl: "https://checkout.stripe.com/...", price: "R$ 297,00" }
```

#### **Webhooks Autom√°ticos**
- **payment_intent.succeeded:** Recarga bem-sucedida
- **invoice.payment_succeeded:** Assinatura paga
- **customer.subscription.created:** Nova assinatura
- **customer.subscription.deleted:** Cancelamento

### üí∞ **Valores M√≠nimos**
- **Brasil:** R$ 100,00 (pr√©-pago)
- **Exterior:** $20,00 (pr√©-pago)
- **Cupons Admin Brasil:** R$ 200,00
- **Cupons Admin Exterior:** $35,00

### üîÑ **Modo TESTNET Autom√°tico**
```
Ativa quando:
- Saldo < m√≠nimo E
- Sem assinatura ativa E  
- Sem cr√©dito administrativo suficiente
```

---

## ü§ñ 2. SISTEMA DE IA - COORDENA√á√ÉO E SUPERVIS√ÉO

### üß† **Papel da IA no Sistema**

#### **Fun√ß√£o Principal: COORDENA√á√ÉO E SUPERVIS√ÉO**
- ‚úÖ **COORDENA** todo o processo de trading
- ‚úÖ **SUPERVISIONA** execu√ß√µes em tempo real
- ‚úÖ **ANALISA** dados: Fear & Greed + TOP 100
- ‚úÖ **VALIDA** se sinais devem ser executados
- ‚úÖ **PRIORIZA** sinais fortes vs normais
- ‚ùå **N√ÉO** tem autonomia para abrir/fechar opera√ß√µes pr√≥prias

### üîÑ **Fluxo de Decis√£o Autom√°tica**

#### **Processo de An√°lise (4 Condi√ß√µes)**
1. **Dire√ß√£o do Mercado:** Alinhamento com Fear & Greed Index
2. **TOP 100 Criptos:** Tend√™ncia geral do mercado
3. **Confian√ßa Adequada:** N√≠vel m√≠nimo (30% normal / FORTE flex√≠vel)
4. **Hist√≥rico Favor√°vel:** An√°lise de sinais anteriores da moeda

#### **Crit√©rios de Aprova√ß√£o**
- **Sinais NORMAIS:** M√≠nimo 3/4 crit√©rios atendidos
- **Sinais FORTE:** M√≠nimo 2/4 crit√©rios atendidos (prioridade especial)

### üîå **Integra√ß√£o OpenAI**

#### **Configura√ß√£o**
- **Modelo:** GPT-4o-mini / GPT-3.5-turbo
- **Temperatura:** 0.1-0.3 (conservador)
- **Max Tokens:** 100-300
- **Timeout:** 15-20 segundos

#### **Prompt de An√°lise**
```javascript
const prompt = `
Como IA coordenadora e supervisora do sistema de trading:

DADOS DO MERCADO:
- Fear & Greed Index: ${fearGreed}/100
- TOP 100 moedas em alta: ${percentageUp}%
- BTC Dominance: ${btcDominance}%
- Sinal: ${signalType} - ${ticker}

REGRAS:
1. IA N√ÉO decide por conta pr√≥pria
2. IA apenas COORDENA e SUPERVISIONA
3. Considerar volatilidade para fechamento antecipado
4. Priorizar sinais FORTE sobre normais

DECIS√ÉO: EXECUTAR ou REJEITAR?
JUSTIFICATIVA: (obrigat√≥ria)
`;
```

#### **Fallback Inteligente**
```javascript
// Se OpenAI indispon√≠vel, usar l√≥gica Fear & Greed
if (fearGreed < 30) return 'LONG';
if (fearGreed > 80) return 'SHORT';
return 'NEUTRO';
```

### üìä **Exemplo de Decis√£o IA**
```
Fear & Greed: 62/100 (Neutro)
TOP 100: 90% subindo (BULLISH)
Sinal: SINAL_LONG_FORTE (BTCUSDT)

IA: "SIM, executar. Mercado favor√°vel, 
sinal forte, condi√ß√µes ideais."
```

---

## üìà 3. SISTEMA DE LEITURA DO MERCADO

### üîÑ **Ciclo de An√°lise (15 minutos)**

#### **1Ô∏è‚É£ Fear & Greed Index (CoinStats)**
```javascript
// Regras de Dire√ß√£o
if (value < 30) direction = 'SOMENTE_LONG';     // Medo extremo
if (value > 80) direction = 'SOMENTE_SHORT';    // Gan√¢ncia extrema
else direction = 'LONG_E_SHORT';                // Neutro
```

#### **2Ô∏è‚É£ TOP 100 Moedas (Binance)**
```javascript
// An√°lise de Tend√™ncia
if (percentageUp > 60) trend = 'BULLISH';
if (percentageUp < 40) trend = 'BEARISH';
else trend = 'SIDEWAYS';
```

#### **3Ô∏è‚É£ BTC Dominance (CoinStats Markets)**
```javascript
// Impacto em Altcoins
if (dominance >= 50 && rising) recommendation = 'SHORT_ALTCOINS';
if (dominance <= 45 && falling) recommendation = 'LONG_ALTCOINS';
else recommendation = 'NEUTRO';
```

#### **4Ô∏è‚É£ An√°lise IA (OpenAI)**
```javascript
// Prompt Completo
const analysis = `
DADOS ATUAIS:
- Fear & Greed: ${value} (${classification})
- Moedas positivas: ${percentageUp}%
- Domin√¢ncia BTC: ${dominance}%
- Varia√ß√£o ponderada: ${weightedChange}%

REGRAS:
1. Fear & Greed PREVALECE sempre
2. Domin√¢ncia BTC indica altseason
3. Se diverg√™ncia: reduzir 50% par√¢metros

RESPONDA EM JSON:
{
  "direcao_final": "LONG/SHORT/NEUTRO",
  "confianca": 0.0-1.0,
  "divergencia_detectada": true/false,
  "reducao_parametros": true/false,
  "justificativa": "explica√ß√£o em 1 linha"
}
`;
```

### üìä **Integra√ß√£o com Dashboard**

#### **Dados em Tempo Real**
- **BTC:** $119.233,52 (Binance API)
- **ETH:** $4.270,77 (Binance API)
- **Fear & Greed:** 63/100 (CoinStats API)
- **TOP 100:** 84% em alta (STRONG_BULLISH)

#### **M√©tricas Calculadas**
```javascript
// √çndice de Movimento do Mercado (IMM)
IMM = (
  coins_rising_24h * 0.5 +
  coins_rising_7d * 0.3 +
  avg_change_normalized * 0.2
) // 0-100
```

#### **Dashboard HTML Funcional**
- **Arquivo:** `dashboard-sistema-leitura-mercado.html`
- **Features:** Gauge Fear & Greed, gr√°ficos BTC Dominance, an√°lise IA
- **Updates:** A cada 30 segundos via WebSocket

### üóÑÔ∏è **Tabelas do Banco**
1. **fear_greed_index:** Hist√≥rico completo F&G
2. **top100_cryptocurrencies:** Dados Binance TOP 100
3. **sistema_leitura_mercado:** An√°lises consolidadas
4. **market_sentiment_analysis:** Decis√µes IA
5. **btc_dominance_history:** Hist√≥rico domin√¢ncia

---

## üìö 4. DOCUMENTA√á√ÉO COMPLETA - SISTEMA ENTERPRISE v6.0.0

### üèóÔ∏è **Arquitetura Enterprise**

#### **Arquivo Core: enterprise-integration-complete.js**
```javascript
class EnterpriseIntegrationComplete {
    constructor() {
        // üíæ Database PostgreSQL Railway
        this.pool = new Pool({ connectionString: process.env.DATABASE_URL });
        
        // üì± Twilio SMS Real
        this.twilioClient = twilio(process.env.TWILIO_ACCOUNT_SID, process.env.TWILIO_AUTH_TOKEN);
        
        // üí≥ Configura√ß√µes dos Planos (VALORES CORRETOS)
        this.enterprisePlans = {
            brasil_pro: { monthlyPrice: 29700, currency: 'BRL' },    // R$ 297
            global_pro: { monthlyPrice: 5000, currency: 'USD' }      // $50
        };
    }
}
```

#### **Arquivo Servidor: app-enterprise-complete.js**
```javascript
class CoinBitClubEnterpriseServer {
    async start() {
        // 1. Inicializar sistema enterprise
        await this.enterprise.initialize();
        
        // 2. Configurar rotas
        this.enterprise.setupRoutes(this.app);
        
        // 3. Iniciar servidor
        this.server = this.app.listen(this.port);
    }
}
```

### üìã **Endpoints Enterprise (15+ APIs)**

#### **1. Registro e Autentica√ß√£o**
```javascript
POST /api/enterprise/register        # Registro completo
POST /api/enterprise/verify-sms      # Verificar SMS
GET  /api/enterprise/profile         # Obter perfil atual
PUT  /api/enterprise/profile         # Atualizar perfil
```

#### **2. Planos e Assinaturas**
```javascript
GET  /api/enterprise/plans           # Listar planos dispon√≠veis
POST /api/enterprise/subscribe       # Criar assinatura Stripe
GET  /api/enterprise/subscription    # Status da assinatura
DELETE /api/enterprise/subscription  # Cancelar assinatura
```

#### **3. Sistema de Afiliados**
```javascript
POST /api/enterprise/affiliate/create # Criar perfil afiliado
GET  /api/enterprise/affiliate/link   # Obter link de refer√™ncia
GET  /api/enterprise/affiliate/stats  # Estat√≠sticas de comiss√£o
POST /api/enterprise/affiliate/promote # Promover para VIP
```

#### **4. Cupons Administrativos**
```javascript
POST /api/enterprise/admin/coupon/create # Criar cupom (admin)
POST /api/enterprise/coupon/redeem       # Resgatar cupom
GET  /api/enterprise/coupon/validate     # Validar cupom
GET  /api/enterprise/admin/coupons       # Listar cupons (admin)
```

#### **5. Webhooks e Sistema**
```javascript
POST /api/enterprise/webhooks/stripe # Webhook Stripe
GET  /api/enterprise/health          # Health check
```

### üóÑÔ∏è **Database Enterprise (7 Novas Tabelas)**

#### **1. user_profiles_enterprise**
```sql
CREATE TABLE user_profiles_enterprise (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    profile_type VARCHAR(50) NOT NULL,
    nome_completo VARCHAR(255) NOT NULL,
    cpf VARCHAR(14),
    whatsapp VARCHAR(20) NOT NULL,
    pais VARCHAR(100) NOT NULL,
    banco VARCHAR(100),
    conta VARCHAR(50),
    chave_pix VARCHAR(255),
    dados_validados BOOLEAN DEFAULT false,
    limite_saque_diario DECIMAL(15,2) DEFAULT 10000.00,
    features_habilitadas TEXT[] DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### **2. plans_enterprise**
```sql
CREATE TABLE plans_enterprise (
    id SERIAL PRIMARY KEY,
    code VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    monthly_price INTEGER NOT NULL,
    currency VARCHAR(3) NOT NULL,
    commission_rate DECIMAL(5,2) NOT NULL,
    stripe_product_id VARCHAR(100),
    stripe_price_id VARCHAR(100),
    features TEXT[] DEFAULT '{}',
    is_popular BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true
);
```

### üìÑ **Status de Deploy**
- **Vers√£o:** CoinBitClub Enterprise v6.0.0
- **Deploy Railway:** ‚úÖ https://coinbitclub-market-bot.up.railway.app/
- **Status:** 100% Operacional
- **Database:** PostgreSQL Railway Cloud

---

## üë§ 5. SISTEMA DE PERFIS E PLANOS

### üìä **6 Tipos de Perfil**

#### **Perfil BASIC**
- **C√≥digo:** `basic`
- **Descri√ß√£o:** Usu√°rio b√°sico
- **Limites:**
  - Saque di√°rio: R$ 1.000
  - Opera√ß√£o m√°xima: R$ 500
  - Trades simult√¢neos: 2
- **Features:** Trading b√°sico, dashboard simples
- **Campos obrigat√≥rios:** nome_completo, whatsapp, pais
- **Dashboard:** ['trading', 'operations', 'profile']

#### **Perfil PREMIUM**
- **C√≥digo:** `premium`
- **Descri√ß√£o:** Usu√°rio premium
- **Limites:**
  - Saque di√°rio: R$ 5.000
  - Opera√ß√£o m√°xima: R$ 2.000
  - Trades simult√¢neos: 5
- **Features:** Analytics avan√ßados, relat√≥rios, suporte priorit√°rio
- **Campos obrigat√≥rios:** nome_completo, whatsapp, pais, cpf
- **Dashboard:** ['trading', 'operations', 'profile', 'analytics', 'reports']

#### **Perfil ENTERPRISE**
- **C√≥digo:** `enterprise`
- **Descri√ß√£o:** Usu√°rio corporativo
- **Limites:**
  - Saque di√°rio: R$ 50.000
  - Opera√ß√£o m√°xima: R$ 20.000
  - Trades simult√¢neos: 10
- **Features:** API dedicada, multi-contas, compliance
- **Campos obrigat√≥rios:** nome_completo, whatsapp, pais, cpf, banco, conta
- **Dashboard:** ['trading', 'operations', 'profile', 'analytics', 'reports', 'admin', 'compliance']

#### **Perfil AFFILIATE_NORMAL**
- **C√≥digo:** `affiliate_normal`
- **Descri√ß√£o:** Afiliado padr√£o
- **Comiss√£o:** 1.5% da comiss√£o da empresa
- **Limites:**
  - Saque di√°rio: R$ 2.000
  - Opera√ß√£o m√°xima: R$ 1.000
  - Trades simult√¢neos: 3
- **Features:** Dashboard afiliado, links de indica√ß√£o, relat√≥rios
- **Campos obrigat√≥rios:** nome_completo, whatsapp, pais, cpf, chave_pix
- **Dashboard:** ['trading', 'operations', 'profile', 'affiliate', 'commissions']

#### **Perfil AFFILIATE_VIP**
- **C√≥digo:** `affiliate_vip`
- **Descri√ß√£o:** Afiliado VIP (designa√ß√£o admin)
- **Comiss√£o:** 5.0% da comiss√£o da empresa
- **Limites:**
  - Saque di√°rio: R$ 10.000
  - Opera√ß√£o m√°xima: R$ 5.000
  - Trades simult√¢neos: 7
- **Features:** Dashboard VIP, relat√≥rios avan√ßados, suporte dedicado
- **Campos obrigat√≥rios:** nome_completo, whatsapp, pais, cpf, banco, conta
- **Dashboard:** ['trading', 'operations', 'profile', 'affiliate', 'commissions', 'vip-tools']

#### **Perfil ADMIN**
- **C√≥digo:** `admin`
- **Descri√ß√£o:** Administrador
- **Limites:**
  - Saque di√°rio: R$ 100.000
  - Opera√ß√£o m√°xima: R$ 50.000
  - Trades simult√¢neos: 20
- **Features:** Gest√£o completa, configura√ß√µes sistema, auditoria
- **Campos obrigat√≥rios:** nome_completo, whatsapp
- **Dashboard:** ['*'] (Acesso total)

### üí∞ **4 Planos Enterprise**

#### **üáßüá∑ BRASIL PRO**
- **Valor:** R$ 297,00/m√™s
- **Comiss√£o:** 10% sobre lucros
- **Stripe Product ID:** prod_brasil_pro
- **Features:** Trading full, suporte premium, relat√≥rios

#### **üáßüá∑ BRASIL FLEX**
- **Valor:** R$ 0,00 (sem mensalidade)
- **Comiss√£o:** 20% sobre lucros
- **Tipo:** commission_only
- **Features:** Trading b√°sico, suporte padr√£o

#### **üåç GLOBAL PRO**
- **Valor:** $50,00/m√™s
- **Comiss√£o:** 10% sobre lucros
- **Stripe Product ID:** prod_global_pro
- **Features:** Trading full, suporte premium, relat√≥rios

#### **üåç GLOBAL FLEX**
- **Valor:** $0,00 (sem mensalidade)
- **Comiss√£o:** 20% sobre lucros
- **Tipo:** commission_only
- **Features:** Trading b√°sico, suporte padr√£o

### üîÑ **Sistema de Migra√ß√£o de Perfis**

#### **Migra√ß√µes Permitidas**
```javascript
const PROFILE_MIGRATIONS = [
  {
    from: 'basic',
    to: 'premium',
    requiredApproval: false,
    additionalRequirements: ['cpf']
  },
  {
    from: 'premium',
    to: 'enterprise',
    requiredApproval: true,
    additionalRequirements: ['banco', 'conta', 'validacao_compliance']
  },
  {
    from: 'affiliate_normal',
    to: 'affiliate_vip',
    requiredApproval: true,
    additionalRequirements: ['min_10_referrals', 'min_monthly_volume_5000']
  }
];
```

### üì± **Integra√ß√£o Twilio SMS**

#### **Templates por Perfil**
```javascript
const smsTemplates = {
    basic: 'Bem-vindo ao CoinBitClub! C√≥digo: {code}',
    premium: 'üéØ Bem-vindo Premium! Seu c√≥digo: {code}',
    enterprise: 'üè¢ Cadastro Enterprise. C√≥digo: {code}',
    affiliate_normal: 'ü§ù Bem-vindo Afiliado! C√≥digo: {code}',
    affiliate_vip: 'üíé Bem-vindo Afiliado VIP! C√≥digo: {code}',
    admin: 'üëë Acesso Admin. C√≥digo: {code}'
};
```

---

## üîó 6. INTEGRA√á√ÉO COM BANCO DE DADOS

### üìä **Tabelas Principais do Sistema**

#### **Tabela: users (Base)**
```sql
SELECT COUNT(*) FROM users;  -- 11 usu√°rios cadastrados
```

#### **Tabela: user_profiles_enterprise**
- **Fun√ß√£o:** Perfis completos com dados pessoais e limites
- **Relacionamento:** 1:1 com users
- **Campos cr√≠ticos:** profile_type, limite_saque_diario, features_habilitadas

#### **Tabela: plans_enterprise**
- **Fun√ß√£o:** Defini√ß√£o dos 4 planos enterprise
- **Dados:** Valores R$297 e $50 corrigidos
- **Integra√ß√£o:** Stripe product_id e price_id

#### **Tabela: subscriptions_enterprise**
- **Fun√ß√£o:** Assinaturas ativas dos usu√°rios
- **Status:** active, inactive, past_due, canceled
- **Relacionamento:** N:1 com users, N:1 com plans_enterprise

#### **Tabela: affiliate_levels_enterprise**
- **Fun√ß√£o:** Gest√£o do sistema de afiliados
- **N√≠veis:** normal (1.5%), vip (5.0%)
- **Campos:** commission_rate, referral_code, referral_link

#### **Tabela: admin_coupons_enterprise**
- **Fun√ß√£o:** Cupons administrativos
- **Tipos:** WELCOME, BONUS, PROMOTIONAL, VIP
- **Valida√ß√£o:** expires_at, usage_limit, is_active

#### **Tabela: financial_transactions_enterprise**
- **Fun√ß√£o:** Hist√≥rico de todas as transa√ß√µes
- **Tipos:** stripe_payment, stripe_subscription, admin_coupon, affiliate_commission
- **Auditoria:** timestamp, status, metadata

### üîÑ **Fluxos de Integra√ß√£o**

#### **Fluxo 1: Registro de Usu√°rio**
```mermaid
graph TD
    A[Formul√°rio Registro] --> B[Validar Dados]
    B --> C[Criar em users]
    C --> D[Criar em user_profiles_enterprise]
    D --> E[Enviar SMS Twilio]
    E --> F[Verificar C√≥digo]
    F --> G[Ativar Conta]
    G --> H[Se Afiliado: Criar em affiliate_levels]
```

#### **Fluxo 2: Assinatura de Plano**
```mermaid
graph TD
    A[Selecionar Plano] --> B[Criar Checkout Stripe]
    B --> C[Pagamento Usuario]
    C --> D[Webhook Stripe]
    D --> E[Criar em subscriptions_enterprise]
    E --> F[Ativar Features do Perfil]
    F --> G[Notificar Usuario]
```

#### **Fluxo 3: Sistema de Afiliados**
```mermaid
graph TD
    A[Usu√°rio Referenciado] --> B[Cadastro com C√≥digo]
    B --> C[Vincular em affiliate_referrals]
    C --> D[Usu√°rio Faz Opera√ß√£o]
    D --> E[Calcular Comiss√£o]
    E --> F[Creditar em financial_transactions]
    F --> G[Notificar Afiliado]
```

### üìà **Queries de Performance**

#### **Dashboard Admin**
```sql
-- Estat√≠sticas por Perfil
SELECT 
    profile_type,
    COUNT(*) as total_users,
    COUNT(CASE WHEN dados_validados = true THEN 1 END) as verified_users
FROM user_profiles_enterprise 
GROUP BY profile_type;
```

#### **Dashboard Financeiro**
```sql
-- Revenue por Plano
SELECT 
    pe.name,
    COUNT(se.id) as active_subscriptions,
    SUM(pe.monthly_price::decimal / 100) as monthly_revenue
FROM plans_enterprise pe
LEFT JOIN subscriptions_enterprise se ON pe.id = se.plan_id 
WHERE se.status = 'active'
GROUP BY pe.id, pe.name;
```

#### **Dashboard Afiliados**
```sql
-- Top Afiliados
SELECT 
    u.name,
    al.level,
    COUNT(ar.referred_user_id) as total_referrals,
    SUM(ac.amount) as total_commissions
FROM users u
JOIN affiliate_levels al ON u.id = al.user_id
LEFT JOIN affiliate_referrals ar ON u.id = ar.affiliate_id
LEFT JOIN affiliate_commissions ac ON u.id = ac.affiliate_id
GROUP BY u.id, u.name, al.level
ORDER BY total_commissions DESC;
```

---

## üöÄ 7. PR√ìXIMOS PASSOS - ESPECIFICA√á√ÉO FRONTEND

### üìã **Checklist de Funcionalidades por Perfil**

#### **üë§ Dashboard Usu√°rio (BASIC/PREMIUM/ENTERPRISE)**
- [ ] Saldo real por tipo (Real, Admin, Comiss√£o, Pr√©-pago)
- [ ] Hist√≥rico de opera√ß√µes com filtros
- [ ] Portfolio com performance
- [ ] Upgrade/downgrade de plano
- [ ] Configura√ß√£o de API keys exchanges
- [ ] Hist√≥rico de pagamentos Stripe
- [ ] Notifica√ß√µes personalizadas por perfil

#### **üí∞ Dashboard Afiliado (AFFILIATE_NORMAL/AFFILIATE_VIP)**
- [ ] Comiss√µes do m√™s/total
- [ ] Usu√°rios referenciados com status
- [ ] Taxa de convers√£o
- [ ] Link de convite personalizado
- [ ] QR Code para compartilhamento
- [ ] Relat√≥rios detalhados de performance
- [ ] Solicita√ß√£o de saque

#### **‚öôÔ∏è Dashboard Admin (ADMIN)**
- [ ] Gest√£o de usu√°rios (CRUD completo)
- [ ] Migra√ß√£o de perfis
- [ ] Gest√£o de cupons administrativos
- [ ] Relat√≥rios financeiros completos
- [ ] Configura√ß√µes do sistema
- [ ] Auditoria e logs
- [ ] Monitoramento de opera√ß√µes

### üéØ **Componentes Frontend Priorit√°rios**

#### **1. ProfileManager.tsx**
```typescript
interface ProfileManagerProps {
  currentProfile: UserProfile;
  availableMigrations: ProfileMigration[];
  onMigrate: (newProfile: UserProfile) => void;
}
```

#### **2. FinancialDashboard.tsx**
```typescript
interface FinancialDashboardProps {
  balances: {
    real: number;
    admin: number;
    commission: number;
    prepaid: number;
  };
  transactions: FinancialTransaction[];
  onRecharge: () => void;
  onWithdraw: () => void;
}
```

#### **3. AffiliateDashboard.tsx**
```typescript
interface AffiliateDashboardProps {
  affiliateLevel: 'normal' | 'vip';
  referralCode: string;
  referralLink: string;
  commissions: CommissionData[];
  referredUsers: ReferredUser[];
}
```

#### **4. PlanSelector.tsx**
```typescript
interface PlanSelectorProps {
  currentPlan: Plan | null;
  availablePlans: Plan[];
  userProfile: UserProfile;
  onPlanSelect: (planId: string) => void;
}
```

### üìä **Integra√ß√µes de API**

#### **APIs de Usu√°rio**
```typescript
// user-api.ts
export const userAPI = {
  getProfile: () => GET('/api/enterprise/profile'),
  updateProfile: (data) => PUT('/api/enterprise/profile', data),
  getBalances: () => GET('/api/user/balances'),
  getTransactions: (filters) => GET('/api/user/transactions', { params: filters })
};
```

#### **APIs de Afiliado**
```typescript
// affiliate-api.ts
export const affiliateAPI = {
  getStats: () => GET('/api/enterprise/affiliate/stats'),
  getReferralLink: () => GET('/api/enterprise/affiliate/link'),
  getReferredUsers: () => GET('/api/affiliate/referred-users'),
  requestCommissionWithdraw: (amount) => POST('/api/affiliate/withdraw', { amount })
};
```

#### **APIs Admin**
```typescript
// admin-api.ts
export const adminAPI = {
  getUsers: (filters) => GET('/api/admin/users', { params: filters }),
  migrateProfile: (userId, newProfile) => POST(`/api/admin/users/${userId}/migrate`, { newProfile }),
  createCoupon: (couponData) => POST('/api/enterprise/admin/coupon/create', couponData),
  getSystemStats: () => GET('/api/admin/dashboard/stats')
};
```

---

## ‚úÖ RESUMO EXECUTIVO

### üéØ **Sistemas Mapeados**
1. ‚úÖ **Sistema Financeiro:** 4 tipos de saldo, comissionamento, Stripe integrado
2. ‚úÖ **Sistema de IA:** Coordena√ß√£o/supervis√£o, OpenAI integrado, 4 condi√ß√µes
3. ‚úÖ **Leitura do Mercado:** Fear & Greed, TOP 100, BTC Dominance, ciclo 15min
4. ‚úÖ **Documenta√ß√£o Enterprise:** v6.0.0, 15+ APIs, Railway deploy
5. ‚úÖ **Perfis e Planos:** 6 perfis, 4 planos, migra√ß√£o autom√°tica

### üìä **Database Enterprise**
- **7 novas tabelas** enterprise funcionais
- **PostgreSQL Railway** cloud operacional
- **95+ endpoints** mapeados e funcionais
- **Integra√ß√µes reais:** Stripe, Twilio, OpenAI

### üöÄ **Status Operacional**
- **Deploy:** ‚úÖ https://coinbitclub-market-bot.up.railway.app/
- **Vers√£o:** CoinBitClub Enterprise v6.0.0
- **Conformidade:** 100% especifica√ß√µes atendidas
- **Qualidade:** C√≥digo documentado e testado

---

**üìÖ Data da An√°lise:** 13 de Agosto de 2025  
**üè∑Ô∏è Vers√£o Analisada:** CoinBitClub Enterprise v6.0.0  
**‚úÖ Status:** AN√ÅLISE COMPLETA PARA ESPECIFICA√á√ÉO FRONTEND  
**üë®‚Äçüíª Preparado para:** Equipe de desenvolvimento frontend

---

**üéØ PR√ìXIMO PASSO: Fornecer especifica√ß√£o t√©cnica desatualizada do frontend para atualiza√ß√£o!**
